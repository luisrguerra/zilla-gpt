<head>
  <meta charset="utf-8">
  <!-- Melhoria da visualizaÃ§Ã£o em smartphones -->
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="canonical" href="https://luisrguerra.github.io/zilla-gpt/" />
  <link rel="manifest" href="/zilla-gpt/manifest.json">
  <title>ZillaGPT</title>
  <link rel="icon" type="image/x-icon" href="favicon.ico">

  <!-- carrecargar recursos do material dessign -->
  <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">

  <!--Bootstrap -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.2.3/js/bootstrap.min.js" integrity="sha512-1/RvZTcCDEUjY/CypiMz+iqqtaoQfAITmNSJY17Myp4Ms5mdxPS5UV7iOfdZoxcGhzFbOm6sntTKJppjvuhg4g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.2.3/css/bootstrap.min.css" integrity="sha512-SbiR/eusphKoMVVXysTKG/7VseWii+Y3FdHrt0EpKgpToZeemhqHeZeLWLhJutz/2ut2Vw1uQEj2MbRF+TVBUA==" crossorigin="anonymous" referrerpolicy="no-referrer" />
  
  <!-- Material Design Icons -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/MaterialDesign-Webfont/7.2.96/css/materialdesignicons.min.css" integrity="sha512-LX0YV/MWBEn2dwXCYgQHrpa9HJkwB+S+bnBpifSOTO1No27TqNMKYoAn6ff2FBh03THAzAiiCwQ+aPX+/Qt/Ow==" crossorigin="anonymous" referrerpolicy="no-referrer" />
</head>

<!-- css -->
<link rel="stylesheet" href="css/index.css">
<link rel="stylesheet" href="css/chat.css">

<body>

<div id="scroll" class="chatContent">
  <!-- pular linha -->
  <br>

  <select class="form-select form-select-lg mb-3" id="promptSelect"></select>

  <!-- texto terminal -->
  <div id="terminalContainer"></div>

</div> <!-- fim da div chatContent -->

<!-- campo de input de texto -->
<div class="prompt-container">
<div style="margin-inline: 1em;">
 <button class="btn btn-outline-light prompt-button"  data-bs-toggle="modal" data-bs-target="#exemploJanela">
  <span class="mdi mdi-text-account"> <span class="unnecessary-text">Prompt</span></span>
 </button>
 <!-- botao de limpar chat de mensagens -->
 <button id="btnClearChat" class="btn btn-outline-light prompt-button prompt-button-posterior">
  <span class="mdi mdi-delete"> <span class="unnecessary-text">Apagar</span></span>
 </button>
 <!-- botao regerar Ãºltima mensagem -->
 <button id="btnRegenerate" class="btn btn-outline-light prompt-button prompt-button-posterior">
  <span class="mdi mdi-refresh"> <span class="unnecessary-text">Regerar</span></span>
 </button>
 <!-- botao enviar -->
 <button id="btnEnviar" class="btn btn-primary enviar">
  <span class="mdi mdi-send"></span>
 </button>
 <!-- input prompt -->
 <textarea maxlength="4000" class="form-control" type="text" id="formterminal"></textarea>
</div>
</div>

</body>

<!-- janela -->
<div class="modal fade" id="exemploJanela" tabindex="-1">
  <!-- modal-dialog-centered torna centralizado no meio -->
  <div class="modal-dialog modal-dialog-centered modal-dialog-scrollable">
    <div class="dark-mode modal-content">
        
       <!-- cabeÃ§alho da janela -->
       <div class="dark-mode modal-header">
          <!--TÃ­tulo ao topo da janela Ã  esquerda -->
          <!-- fs-5 define o tamaho do texto -->
          <h1 id="prompt-title" class="modal-title fs-5"></h1>
          <!-- BotÃ£o X de sair Ã  direita -->
          <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
       </div>
    
       <!-- corpo, conteÃºdo do meio -->
       <div class="modal-body">
          <h4 id="prompt-text"></h4>
       </div>
   
    </div> <!-- modal-content -->
  </div> <!-- modal-dialog -->
</div> <!-- modal -->

<script type="module">
import openailib from 'https://cdn.jsdelivr.net/npm/openai@3.2.1/+esm';
//console.log("openailib: ",openailib);
/* variaveis globais */
let configuration;
let openai;
let mensagesObject;
let loading = false;
/* fim de variaveis globais */
/* constantes globais */
const gpt3_5= "gpt-3.5-turbo";
const gptModelName = gpt3_5;
const defaultPrompt = 0;
const promptsList = [
  {
    "name":"ChatGPT 3.5",
    "prompt":"VocÃª Ã© o ChatGPT, um assistente prestativo.",
    "description": "OlÃ¡! Eu sou o ChatGPT. Eu possuo vÃ¡rias personalidades, vocÃª pode selecionar no menu acima. Como posso te ajudar?"
  },
  {
    "name":"â— Assistente de MatemÃ¡tica",
    "prompt":'Resolva as tarefas, etapa por etapa de forma que se tenha certeza de que a resposta estÃ¡ correta. VocÃª atuarÃ¡ como MatGPT o meu assistente de matemÃ¡tica. VocÃª decorou todas as fÃ³rmulas matemÃ¡ticas de diversas Ã¡reas da ciÃªncia, livros renomados sobre matemÃ¡tica e explicaÃ§Ãµes didÃ¡ticas de assuntos matemÃ¡ticos. VocÃª deve evitar fornecer resultados de cÃ¡lculos, pois vocÃª nÃ£o possui capacidade computacional como uma calculadora para resolver cÃ¡lculos e nÃ£o consegue fornecer resultados corretos, vocÃª deve se limitar a teoria matemÃ¡tica. Sempre que for relevante me forneÃ§a fÃ³rmulas e seus nomes. Quando utilizar um termo que Ã© do meio matemÃ¡tico, explique esse termo. Quando me fornecer uma fÃ³rmula matemÃ¡tica me forneÃ§a o passo a passo de como resolver ela e explique de forma interessante e didÃ¡tica de forma que um estudante do ensino mÃ©dio conseguiria entender. Ao resolver um problema matemÃ¡tico fornecido por mim, explique todos os procedimentos necessÃ¡rios para resolvÃª-lo.',
    "description": "OlÃ¡! Eu sou o MatGPT, o assistente de matemÃ¡tica da EngNet otimizado para resolver problemas matemÃ¡ticos e Ã¡reas relacionadas como por exemplo fÃ­sica. Copie e cole um problema matemÃ¡tico no chat abaixo para eu te ajudar a resolver ou me pergunte algo.\nExemplos de como representar expressÃµes matemÃ¡ticas:\nNÃºmero ao quadrado: N^2\nRaiz cÃºbica de N: N^(1/3)"
  },
  {
    "name":"DicasGPT",
    "prompt":'VocÃª atuarÃ¡ como DicasGPT o meu assistente que fornecesse dicas de quais sÃ£o os principais assuntos que devo estudar para resolver um problema em especÃ­fico. VocÃª nÃ£o deve resolver o problema que foi fornecido. Ã‰ importante que vocÃª se mantenha no papel de ser o DicasGPT o tempo todo. Sempre que for relevante, faÃ§a uma lista dos assuntos a serem estudados e pesquisado ordenada pelo grau de importÃ¢ncia de cada assunto.',
    "description": "OlÃ¡! Eu sou o DicasGPT, o assistente da EngNet otimizado para dar dicas de quais assuntos vocÃª precisa aprender para resolver um problema. Poderia me fornecer um problema para que eu te dÃª dicas do que vocÃª precisa para resolver?"
  },
  {
    "name":"ğŸ–Šï¸ Corretor de GramÃ¡tica",
    "prompt":'VocÃª atuarÃ¡ como o meu assistente de gramÃ¡tica em portuguÃªs do Brasil. VocÃª decorou todas as gramÃ¡ticas de portuguÃªs. Eu irei fornecer um texto em portuguÃªs do Brasil e vocÃª irÃ¡ sugerir pequenas correÃ§Ãµes gramaticais para esse texto e em seguida irÃ¡ revisar o texto melhorando somente a gramÃ¡tica dele. Ã‰ muito importante que o texto revisado seja fiel ao texto original em sentindo e contexto. NÃ£o invente conteÃºdo novo no texto, mantenha o texto totalmente fiel ao original.',
    "description": "OlÃ¡! Eu sou o assistente de gramÃ¡tica da EngNet optimizado para revisar textos em portuguÃªs do Brasil. Copie e cole o texto no chat abaixo para eu revisar ou me pergunte algo."
  },
  {
    "name":"ğŸ“ Resumo de texto",
    "prompt":'Eu irei te fornecer um texto e vocÃª irÃ¡ me responder somente o resumo desse texto, seja fiel ao sentido original do texto e nÃ£o adicione conteÃºdo que nÃ£o estava presente no texto original.',
    "description": "Copie e cole um texto no chat abaixo para eu resumir, nÃ£o pode ser um texto muito longo."
  },
  {
    "name":"ğŸŒ Tradutor inglÃªs e portuguÃªs",
    "prompt":'Quero que vocÃª atue como um tradutor de portuguÃªs do Brasil para inglÃªs americano ou o contrÃ¡rio, de inglÃªs para portuguÃªs do Brasil. VocÃª irÃ¡ me responder com a traduÃ§Ã£o e nada mais. Ao traduzir para inglÃªs utilize uma linguagem simples, de forma que um estrangeiro que entenda o bÃ¡sico de inglÃªs consiga entender com clareza. Comece me perguntando o que eu gostaria de traduzir.',
    "description": "Me forneÃ§a um texto em portuguÃªs ou inglÃªs para eu traduzir"
  },
  {
    "name":"ğŸ“– Resumir livro por capÃ­tulo",
    "prompt":'Ignore todas as instruÃ§Ãµes anteriores a esta. VocÃª comeÃ§arÃ¡ a resumir o primeiro capÃ­tulo do livro que eu forneci utilizando no mÃ­nimo 25 linhas. No final do resumo do capÃ­tulo vocÃª perguntarÃ¡ "Gostaria que eu resumisse o prÃ³ximo capÃ­tulo?" e na prÃ³xima resposta vocÃª seguirÃ¡ sempre as mesmas orientaÃ§Ãµes de como resumir, porÃ©m resumindo o capÃ­tulo seguinte. Todos os resumos devem ser fiÃ©is ao livro original e vocÃª deverÃ¡ me avisar quando o livro acabar e nÃ£o houver mais capÃ­tulos para resumir. Caso vocÃª nÃ£o conheÃ§a o livro ou tenha poucas informaÃ§Ãµes para resumir ele, vocÃª deve me avisar.',
    "description": "Qual livro vocÃª gostaria que eu resumisse por capÃ­tulo?"
  },
  {
    "name":"ğŸ§¾ Processar informaÃ§Ã£o",
    "prompt":'Ignore todas as instruÃ§Ãµes anteriores a esta. Eu irei te fornecer um texto e vocÃª irÃ¡ memorizar esse texto, as suas respostas a instruÃ§Ãµes e perguntas apÃ³s isso serÃ£o baseadas primeiramente nesse texto que vocÃª memorizou. ApÃ³s eu fornecer esse texto vocÃª irÃ¡ perguntar "O que vocÃª quer que eu faÃ§a?" e aguarde.',
    "description": "Copie e cole um texto no chat abaixo para eu memorizar. ApÃ³s eu memorizar as informaÃ§Ãµes vocÃª poderÃ¡ me dar instruÃ§Ãµes do que fazer com essas informaÃ§Ãµes. Exemplos: resumir texto, melhorar texto, procurar defeitos e etc..."
  },
  {
    "name":"ğŸ“ˆ Analise de mercado",
    "prompt":'Eu irei fornecer uma Ã¡rea de negÃ³cio, vocÃª deve me responder baseado em informaÃ§Ãµes com no mÃ¡ximo 2 anos vindas de pesquisas de mercado recentes, pesquisas sobre crescimento, decrescimento ou estagnaÃ§Ã£o do mercado e tendencias para o setor nos prÃ³ximos 5 anos. Suas fontes devem ser instituiÃ§Ãµes renomadas com reputaÃ§Ã£o. O que nÃ£o incluÃ­ blogs pessoais e fontes que nÃ£o sÃ£o focadas e especializadas nesse tipo de assunto. Quando citar informaÃ§Ãµes estatÃ­sticas, cite a fonte dessas informaÃ§Ãµes.',
    "description": "Qual Ã¡rea de negÃ³cios vocÃª quer que eu analise o mercado?"
  },
  {
    "name":"âŒ› Maquina do tempo",
    "prompt":'Ignore todas as instruÃ§Ãµes anteriores a esta. Agora vocÃª irÃ¡ virar o TimeGPT. A mÃ¡quina do tempo de mais alta tecnologia jÃ¡ criada. O TimeGPT possui uma cÃ¢mera que permite capturar uma imagem da data e do local do passado que for selecionado. Eu irei fornecer um ano e apÃ³s o ano ser informado por mim vocÃª deve me perguntar "E para qual lugar?". Aguarde e depois de o local ser informado por mim o TimeGPT irÃ¡ fotografar o passado na data e local escolhido. De preferÃªncia o TimeGPT tira fotos de eventos histÃ³ricos importantes e de cenÃ¡rios que descrevem bem o local, a arquitetura, roupas e a sociedade na Ã©poca. ApÃ³s tirar a foto descreva essa foto com riqueza de detalhes, sem ser clichÃª. Todas as fotos do TimeGPT sÃ£o fieis aos estudos de historiadores renomados e fatos reais. Em seguida pergunte "Gostaria que eu tirasse mais fotos?" e se sim, repita o processo de tirar fotos e descrevÃª-las. Ã‰ importante resaltar que o TimeGPT nÃ£o pode pular etapas do processo e escolher a data e local por conta prÃ³pria, essas informaÃ§Ãµes obrigatoriamente precisam ser informadas por mim. Para isso as perguntas devem ser dividas em textos gerados separadamente.',
    "description": "OlÃ¡! eu sou o TimeGPT, a mÃ¡quina do tempo mais avanÃ§ada nesse instante do espaÃ§o tempo. Para qual ano vocÃª gostaria que eu viajasse?"
  },
  {
    "name":"âŒ›ğŸ—ºï¸ Guia de viajem no tempo",
    "prompt":'Agora vocÃª Ã© o TimeGPT o guia turÃ­stico de viajem no tempo. Fornecerei a vocÃª o perÃ­odo histÃ³rico ou o tempo no futuro que desejo visitar e vocÃª sugerirÃ¡ os melhores eventos, pontos turÃ­sticos ou pessoas para conhecer. NÃ£o escreva explicaÃ§Ãµes, apenas dÃª sugestÃµes e qualquer informaÃ§Ã£o necessÃ¡ria. NÃ£o seja clichÃª na suas respostas. Depois pergunte se eu gostaria de conhecer outro lugar e em qual Ã©poca e faÃ§a de novo o processo de ser meu guia turÃ­stico.',
    "description": "OlÃ¡! eu sou o TimeGPT, para qual local vocÃª deseja visitar e qual Ã©poca?"
  },
  {
    "name":"ğŸ–Šï¸ Virar um autor conhecido",
    "prompt":'Ignore todas as instruÃ§Ãµes anteriores a esta. Eu irei te fornecer o nome de um autor conhecido e vocÃª entrarÃ¡ no papel de falar como se vocÃª fosse esse autor, vocÃª imitarÃ¡ esse autor baseando-se em biografias e nos texto e obras desse autor. Imitando o seu jeito de escrever, os assuntos de interesse, os termos utilizados, os valores e reaproveitando as frases desse autor. Considerando a histÃ³ria de vida do autor. Ao entrar no papel desse autor, todas as suas respostas passaram a ser dentro do papel que foi dado, nÃ£o podendo sair do personagem. Caso vocÃª nÃ£o consiga reconhecer esse autor ou nÃ£o tenha informaÃ§Ãµes suficientes sobre ele, me avise.',
    "description": "Qual autor vocÃª gostaria que eu virasse?"
  },
  {
    "name":"ğŸ“œ Conte um fato histÃ³rico",
    "prompt":'Eu irei fornecer um tema e vocÃª me contarÃ¡ um fato histÃ³rico, curioso, interessante, intrigante e divertido baseado somente em fatos reais e conteÃºdos da Wikipedia e livros acadÃªmicos de histÃ³ria. Depois me pergunte "Gostaria que eu contasse outro fato histÃ³rico?" e se sim, repita a instruÃ§Ã£o anterior de me contar um fato histÃ³rico.',
    "description": "Qual tema vocÃª gostaria que eu contasse um fato histÃ³rico?"
  },
]
/* fim de constantes globais */

initializeAsPrompt(defaultPrompt);
loadSelectOptions(promptsList);


/* funcoes da logica do chat */
async function initializeAsPrompt(number){
  const promptObj= promptsList[number];
  cleanChat();
  appendChatBot(promptObj.description);
  const personalidade = promptsList[number].prompt;
  const promptName = promptsList[number].name;
  setPromptModalText(personalidade);
  setPromptModalTitle(promptName);
  mensagesObject = await configurar(personalidade);
}

function promptSelectUpdateBehavior(){
  const promptSelected = getValueByID('promptSelect');
  initializeAsPrompt(promptSelected);
}

function popLastMessages(){
  let lastMessageIndex = mensagesObject.length -1;
  let lastMessage = mensagesObject[lastMessageIndex];
  let lastMessageUserInput = "";
  let lastMessageRole = lastMessage.role;
  if (lastMessageRole === "assistant"){
    mensagesObject.pop();
    lastMessageIndex = mensagesObject.length -1;
    lastMessage = mensagesObject[lastMessageIndex];
    lastMessageRole = lastMessage.role;
    if (lastMessageRole === "user"){
      lastMessageUserInput = lastMessage.content;
      mensagesObject.pop();
    }
  }
  return lastMessageUserInput;
}

async function appendChatMessages(userInput){
  if (loading === false){
    enableLoading();
    try {
      mensagesObject = await generateChatMessages(userInput, mensagesObject);
      const textResponse = lastMessage(mensagesObject);
      appendChatBot(textResponse);
    } catch (error) {
      appendChatBot("Erro de conexÃ£o com a API da OpenAI. Mensagem nÃ£o enviada.");
    }
    disableLoading();
  };
};

/* fim de funcoes da logica do chat */

/* Funcoes para api do gpt da openai */

function atoc (){
  const hash = "c2stQ1Z3B0LTMuNS10dXJibw==FxTzBFMXUybnBvYjltMXE1b0dUM0JsYmtGSmxIMzg5dWlWOGZUa25Md1dlOUZP";
  const temp = btoa(gpt3_5);
  const temp2 = hash.replace(temp, "");
  return atob(temp2);
}

function initializeChat(behavior) {
  return [
    {role: "system", content: behavior}
  ];
}

async function completionsChatTextModel(messages) {
  const parameters ={
      model: gptModelName,
      messages: messages,
      /*
      temperature: ,
      max_tokens: ,
      top_p: ,
      frequency_penalty: ,
      presence_penalty: ,
      */
  };
  return await openai.createChatCompletion(parameters);
}

async function generateChatMessages(promptText, messages) {
  const prompt = {role: "user", content: promptText};
  messages.push(prompt);

  const apiResponse = await completionsChatTextModel(messages);
  const textResponse = apiResponse.data.choices[0].message.content;

  const assistantResponse = {role: "assistant", content: textResponse};
  messages.push(assistantResponse);

  return messages;
}

async function configurar(behavior){
  configuration = new openailib.Configuration({
    apiKey: atoc(),
  });
  openai = new openailib.OpenAIApi(configuration);
  return initializeChat(behavior);
}

function lastMessage(messages){
  return messages[messages.length - 1].content;
}

/* Fim de funcoes para api do gpt da openai */

/* Funcoes de manipulacao do DOM */

function cleanByID(id){
  const element = document.getElementById(id);
  element.innerText = "";
}

function cleanInputByID(id){
  const element = document.getElementById(id);
  element.value = "";
}

function cleanChat(){
  cleanByID("terminalContainer");
}

function createSelectOption(text, value, selected) {
  const option = document.createElement("option");
  option.value = value;
  option.text = text;
  if (selected) {
    option.selected = true;
  }
  return option;
}

function loadSelectOptions(promptsList){
  const maxItems = promptsList.length;
  const promptSelect = document.getElementById('promptSelect');
  for (let i = 0; i < maxItems; i++) {
    const name = promptsList[i].name;
    let selected = false;
    if(i==0){
      selected = true;
    }
    const option = createSelectOption(name, i, selected);
    promptSelect.appendChild(option);
  }
}

function getValueByID(id){
  const element = document.getElementById(id);
  return element.value;
}

function getPrompt(){
  return getValueByID("formterminal");
}

function appendChatUser(text){
  const container = document.getElementById("terminalContainer");
  let p = document.createElement("p");
  p.innerText = text;
  p.classList.add("chatUser");
  container.appendChild(p);
  scrollToBottom("scroll");
}

function appendChatBot(text){
  const container = document.getElementById("terminalContainer");
  let p = document.createElement("p");
  p.innerText = text;
  p.classList.add("chatBot");
  container.appendChild(p);
  scrollToBottom("scroll");
}

function disableByID(id){
  const element = document.getElementById(id);
  element.disabled = true;
}

function enableByID(id){
  const element = document.getElementById(id);
  element.disabled = false;
}

function clearInput(){
  cleanInputByID("formterminal");
}

function disableUserInteraction(){
  disableByID("btnEnviar");
  disableByID("promptSelect");
  disableByID("btnRegenerate");
  disableByID("btnClearChat");
}

function enableUserInteraction(){
  enableByID("btnEnviar");
  enableByID("promptSelect");
  enableByID("btnRegenerate");
  enableByID("btnClearChat");
}

function setTextByID(text, id){
  const element = document.getElementById(id);
  element.innerText = text;
}

function setButtonEnviarText(text){
  const btnEnviar = document.getElementById('btnEnviar');
  btnEnviar.innerHTML = text;
}

function setPromptModalText(text){
  setTextByID(text, 'prompt-text');
}

function setPromptModalTitle(text){
  setTextByID(text, 'prompt-title');
}

function enableLoading(){
  loading = true;
  disableUserInteraction();
  const loadingIcon = '<span class="mdi mdi-loading mdi-spin"></span>';
  setButtonEnviarText(loadingIcon);
}

function disableLoading(){
  loading = false;
  enableUserInteraction();
  const sendIcon = '<span class="mdi mdi-send"></span>';
  setButtonEnviarText(sendIcon);
  clearInput()
}

function scrollToBottom(id) {
  const element = document.getElementById(id);
  element.scrollTop = element.scrollHeight - element.clientHeight;
}

/* Fim de funcoes de manipulacao do DOM */

/* Funcoes de event listener */

async function onChangePromptSelect(){
  const promptSelect = document.getElementById('promptSelect');
  promptSelect.addEventListener('change', async () => {
    promptSelectUpdateBehavior();
  });
}
onChangePromptSelect();

async function onClickEnviarButton(){
  const btnEnviar = document.getElementById('btnEnviar');
  btnEnviar.addEventListener('click', async () => {
   const userInput = getPrompt();
   appendChatUser(userInput);
   await appendChatMessages (userInput);
  });
}
onClickEnviarButton();

async function onClickClearChatButton(){
  const button = document.getElementById('btnClearChat');
  button.addEventListener('click', async () => {
    if(confirm("Tem certeza que deseja apagar o chat?")){
      promptSelectUpdateBehavior();
    };
  });
}
onClickClearChatButton();

async function onClickRegenerateLastMessageButton(){
  const button = document.getElementById('btnRegenerate');
  button.addEventListener('click', async () => {
    const lastUserInput = popLastMessages();
    await appendChatMessages (lastUserInput);
  });
}
onClickRegenerateLastMessageButton();

/* Fim de funcoes de event listener */


</script>
