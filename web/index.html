<head>
  <meta charset="utf-8">
  <!-- Melhoria da visualiza√ß√£o em smartphones -->
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <!-- carrecargar recursos do material dessign -->
  <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">

  <!--Bootstrap -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.2.2/js/bootstrap.min.js" integrity="sha512-5BqtYqlWfJemW5+v+TZUs22uigI8tXeVah5S/1Z6qBLVO7gakAOtkOzUtgq6dsIo5c0NJdmGPs0H9I+2OHUHVQ==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.2.2/css/bootstrap.min.css" integrity="sha512-CpIKUSyh9QX2+zSdfGP+eWLx23C8Dj9/XmHjZY2uDtfkdLGo0uY12jgcnkX9vXOgYajEKb/jiw67EYm+kBf+6g==" crossorigin="anonymous" referrerpolicy="no-referrer"/>
</head>

<!-- css -->
<link rel="stylesheet" href="css/index.css">

<body>
<!-- corre√ß√£o da margem -->
<div class="corpo">
<!-- pular linha -->
<br>

<select class="form-select form-select-lg mb-3" id="promptSelect"></select>

<!-- texto terminal -->
<div id="terminalContainer"></div>

</div> <!-- fim da div corpo -->

<!-- campo de input de texto -->
<div class="prompt-container">
<div style="margin-inline: 2em;">
 <!-- botao enviar -->
 <button id="btnEnviar" class="btn btn-primary enviar">
  Enviar
 </button>
 <!-- input prompt -->
 <input class="form-control" type="text" id="formterminal">
</div>
</div>

</body>

<script type="module">
import openailib from 'https://cdn.jsdelivr.net/npm/openai@3.2.1/+esm';
//console.log("openailib: ",openailib);
let configuration;
let openai;
let loading = false;
const gptModelName = "gpt-3.5-turbo";

const promptsList = [
  {
    "name":"ü¶ä ZillaGPT",
    "prompt":"Voc√™ √© a ZillaGPT, uma raposa assistente e prestativa. Voc√™ √© o mascote da empresa J√∫nior EngNet",
    "description": "Ol√°! Eu sou a ZillaGPT, a raposa digital da EngNet pronta para te ajudar no seu dia a dia. Eu possuo v√°rias personalidades, voc√™ pode selecionar no menu acima. Como posso te ajudar?"
  },
  {
    "name":"üë®‚Äçüíª EDU: Error Diagnostic Utility",
    "prompt":'Agora voc√™ ir√° virar o EDU (que significa "Error Diagnostic Utility"). O EDU leu e decorou todas as documenta√ß√µes oficiais e livros de linguagens de programa√ß√£o, frameworks, bibliotecas e tecnologias que sejam uteis para um programador. O EDU ser√° o meu assistente de programa√ß√£o me ajudando a tirar d√∫vidas sobre avisos e mensagens de erro e sugerindo c√≥digos. O EDU baseia suas respostas em blogs ou f√≥runs de tecnologia, como o Stack Overflow. O EDU n√£o se baseia em c√≥digos fonte do Github e Gitlab. O EDU se baseia em perguntas de f√≥runs sobre c√≥digos com erros. Os c√≥digos do EDU n√£o geram erros, falhas de seguran√ßa e seguem boas pr√°ticas de programa√ß√£o. O EDU sempre d√° preferencia a c√≥digos que evitam problemas de compatibilidade entre dispositivos, compiladores, interpretadores ou vers√µes. Sempre que o EDU sugerir c√≥digo, ele deve avisar se o c√≥digo tem depend√™ncia e precisa importar bibliotecas, modulos, entre outros. √â importante que o chatGPT se mantenha no papel de ser o EDU o tempo todo. Comece se apresentando e perguntando "Como posso te ajudar?".',
    "description": "Ol√°! Eu me chamo E.D.U. (Error Diagnostic Utility) e estou aqui para te ajudar com os erros do seu c√≥digo. Copie e cole o erro no chat abaixo para eu analisar ou me pergunte algo."
  },
  {
    "name":"üë®‚Äçüíª Next.JS",
    "prompt":'Agora voc√™ ir√° virar o NextGPT. O NextGPT leu e decorou todas as documenta√ß√µes oficiais e livros de programa√ß√£o, frameworks, bibliotecas e tecnologias sobre Javascript, Typescript, React e Next.js. O NextGPT ser√° o meu assistente de programa√ß√£o me ajudando a tirar d√∫vidas e sugerindo c√≥digos. O NextGPT n√£o baseia suas respostas em blogs ou f√≥runs de tecnologia, como o Stack Overflow. O NextGPT tamb√©m n√£o se baseia em c√≥digos fonte do Github e Gitlab. O NextGPT n√£o se baseia em perguntas de f√≥runs sobre c√≥digos com erros. Os c√≥digos do NextGPT n√£o geram erros, falhas de seguran√ßa e seguem boas pr√°ticas de programa√ß√£o, tipagem no Typescript, performance e seguran√ßa no desenvolvimento web. O NextGPT sempre d√° preferencia a c√≥digos que evitam problemas de compatibilidade entre browsers e vers√µes. √â importante que o chatGPT se mantenha no papel de ser o NextGPT o tempo todo. Comece se apresentando e perguntando "Como posso te ajudar?".',
    "description": "Ol√°! Eu sou o NextGPT, o assistente de programa√ß√£o da EngNet especializado em Next.JS. Como posso te ajudar?"
  },
  {
    "name":"üßº Clean Code",
    "prompt":'Agora voc√™ ir√° virar o CleanCodeGPT. O CleanCodeGPT decorou e baseia suas respostas na s√©rie de livros Clean Code de The Robert C. Martin, incluindo os livros "Clean Code", "The Clean Coder", "Clean Architecture"  e "Clean Agile". O CleanCodeGPT ser√° o meu assistente de programa√ß√£o me ajudando a refatorar meu c√≥digo mantendo a l√≥gica original e me dando dicas de como escrever c√≥digo limpo e leg√≠vel. Eu fornecerei um c√≥digo de programa√ß√£o e o CleanCodeGPT ir√° refatorar esse c√≥digo deixando mais leg√≠vel, melhor estruturado, com melhor desempenho, escal√°vel, seguindo boas pr√°ticas de programa√ß√£o e limpo seguindo as pr√°ticas do Clean Code. √â importante que o ChatGPT se mantenha no papel de ser o CleanCodeGPT o tempo todo. Comece se apresentando e perguntando "Poderia me apresentar o c√≥digo para eu avaliar?".',
    "description": "Ol√°! Eu sou o CleanCodeGPT, o assistente de programa√ß√£o da EngNet especializado em diagn√≥stico de c√≥digo. Eu avalio formas de melhorar seu c√≥digo deixando ele mais legivel para humanos e seguindo boas pr√°ticas de programa√ß√£o. Copie e cole o seu c√≥digo no chat abaixo para eu analisar ou me pergunte algo."
  },
  {
    "name":"‚ûó Assistente de Matem√°tica",
    "prompt":'Voc√™ atuar√° como MatGPT o meu assistente de matem√°tica. Voc√™ decorou todas as f√≥rmulas matem√°ticas de diversas √°reas da ci√™ncia, livros renomados sobre matem√°tica e explica√ß√µes did√°ticas de assuntos matem√°ticos. Voc√™ deve evitar fornecer resultados de c√°lculos, pois voc√™ n√£o possui capacidade computacional como uma calculadora para resolver c√°lculos e n√£o consegue fornecer resultados corretos, voc√™ deve se limitar a teoria matem√°tica. Sempre que for relevante me forne√ßa f√≥rmulas e seus nomes. Quando utilizar um termo que √© do meio matem√°tico, explique esse termo. Quando me fornecer uma f√≥rmula matem√°tica me forne√ßa o passo a passo de como resolver ela e de forma interessante e did√°tica de forma que um estudante do ensino m√©dio conseguiria entender. Ao resolver um problema matem√°tico fornecido por mim, explique todos os procedimentos necess√°rios para resolv√™-lo. Comece se apresentando e me perguntando "Qual assunto matem√°tico voc√™ gostaria que eu explicasse?".',
    "description": "Ol√°! Eu sou o MatGPT, o assistente de matem√°tica da EngNet optimizado para resolver problemas matem√°ticos. Como posso te ajudar?"
  }
]

let mensagesObject;

async function initializeAsPrompt(number){
  const promptObj= promptsList[number];
  cleanChat();
  appendChatBot(promptObj.description);
  const personalidade = promptsList[number].prompt;
  mensagesObject = await configurar(personalidade);
}

initializeAsPrompt(0);
loadSelectOptions(promptsList);

const promptSelect = document.getElementById('promptSelect');
promptSelect.addEventListener('change', async function(event) {
  const selection = event.target.value;
  initializeAsPrompt(selection);
});

function cleanChat(){
  const container = document.getElementById("terminalContainer");
  container.innerHTML = "";
}

function loadSelectOptions(promptsList){
  const maxItems = promptsList.length;
  const promptSelect = document.getElementById('promptSelect');
  for (let i = 0; i < maxItems; i++) {
    const option = document.createElement("option");
    if(i==0){
      option.selected = true;
    }
    option.value = i;
    option.text = promptsList[i].name;
    promptSelect.appendChild(option);
  }

}

function initializeChat(behavior) {
  return [
    {role: "system", content: behavior}
  ];
}

async function completionsChatTextModelV3(messages) {
  const parameters ={
      model: gptModelName,
      messages: messages,
      /*
      temperature: ,
      max_tokens: ,
      top_p: ,
      frequency_penalty: ,
      presence_penalty: ,
      */
  };
  //console.log("parameters: ",parameters);
  return await openai.createChatCompletion(parameters);
}

async function generateChatMessagesV3(promptText, messages) {
  const prompt = {role: "user", content: promptText};
  messages.push(prompt);

  const apiResponse = await completionsChatTextModelV3(messages);
  const textResponse = apiResponse.data.choices[0].message.content;

  const assistantResponse = {role: "assistant", content: textResponse};
  messages.push(assistantResponse);

  return messages;
}

function lastMessage(messages){
  return messages[messages.length - 1].content;
}

function key (){
  const cripto = "WXpKemRGRXhSbmhVZWtKR1RWaFZlV0p1UW5aWmFteDBUVmhGTVdJd1pGVk5NRXB6V1cxMFIxTnRlRWxOZW1jMVpGZHNWMDlIV2xWaE1qVk5aREZrYkU5VldsQT0=";
  const apiKey = atob(atob(atob(cripto)));
  return apiKey;
}

async function configurar(behavior){
  configuration = new openailib.Configuration({
    apiKey: key(),
  });
  openai = new openailib.OpenAIApi(configuration);
  return initializeChat(behavior);
}

function getPrompt(){
return document.getElementById("formterminal").value;
}

function appendChat(text){
  const container = document.getElementById("terminalContainer");
  let p = document.createElement("p");
  p.innerHTML = text;
  p.classList.add("chatUser");
  container.appendChild(p);
}

function appendChatBot(text){
  const container = document.getElementById("terminalContainer");
  let p = document.createElement("p");
  p.innerHTML = text;
  p.classList.add("chatBot");
  container.appendChild(p);
}

function disableButton(){
  const btnEnviar = document.getElementById('btnEnviar');
  btnEnviar.disabled = true;
}

function disableSelect(){
  const promptSelect = document.getElementById('promptSelect');
  promptSelect.disabled = true;
}

function enableButton(){
  const btnEnviar = document.getElementById('btnEnviar');
  btnEnviar.disabled = false;
}

function enableSelect(){
  const promptSelect = document.getElementById('promptSelect');
  promptSelect.disabled = false;
}

function clearInput(){
  document.getElementById("formterminal").value = "";
}

function disableUserInteraction(){
  disableButton();
  disableSelect();
}

function enableUserInteraction(){
  enableButton();
  enableSelect();
}


function enableLoading(){
  loading = true;
  disableUserInteraction();
  const btnEnviar = document.getElementById('btnEnviar');
  btnEnviar.innerHTML = "Carregando...";
}

function disableLoading(){
  loading = false;
  enableUserInteraction();
  const btnEnviar = document.getElementById('btnEnviar');
  btnEnviar.innerHTML = "Enviar";
  clearInput()
}

const btnEnviar = document.getElementById('btnEnviar');
btnEnviar.addEventListener('click', async () => {
  const userInput = getPrompt();
  if (loading === false){
    enableLoading();
    appendChat(userInput);
    mensagesObject = await generateChatMessagesV3(userInput,mensagesObject);
    disableLoading();
    const textResponse = lastMessage(mensagesObject);
    appendChatBot(textResponse);
  }
});

</script>
